<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Settings</title>
        <script src="//static.parastorage.com/services/third-party/react/15.3.1/react-with-addons.min.js"></script>
        <script src="//static.parastorage.com/services/third-party/react/15.3.1/react-dom.min.js"></script>
        <script src="//static.parastorage.com/services/third-party/jquery/3.1.1/dist/jquery.min.js"></script>
        <script src="//static.parastorage.com/services/third-party/lodash/4.17.2/lodash.js"></script>
        <script src="//static.parastorage.com/services/js-sdk/1.87.0/js/wix.min.js"></script>
        <script src="//static.parastorage.com/services/editor-ui-lib/1.28.0/lib/editor-ui-lib-jquery.min.js"></script>
        <style>
            [wix-ctrl] {
                margin: 10px 15px;
            }
        </style>
        <script type="text/javascript">
            var Settings = function () {};

            Settings.prototype.update = function (key, val) {
                Wix.Settings.triggerSettingsUpdatedEvent({key: key, value: val});
            };

            Settings.prototype.attachListeners = function () {
                var $self = this;
                console.log($self);
                jQuery('[wix-ctrl]').each(function (index, element) {
                    var callback = jQuery(element).getCtrl().onChange;
                    if(jQuery.isFunction(callback)) {
                        callback(function (value) {
                            $self.update(jQuery(element).attr('wix-param'), value);
                        });
                    }
                });
            }

            var settings = new Settings();

            jQuery(document).ready(function() {
                settings.attachListeners();
            });
        </script>
    </head>
    <body>
        <div wix-ctrl="appSettings"></div>
        <div id="sampleDock" wix-ctrl="Dock"
             wix-options="{title: 'Select position', defaultValue:'TOP_RIGHT'}">
        </div>
        <hr class="divider-long">
        <div id="textInput" wix-ctrl="Input"
            wix-options="{ placeholder: 'Code', title: 'Input TItle', infoText: 'Tooltip Text', isMultiLine: 'true', invalidMessage: 'Wrong Input!' }">
        </div>
        <hr class="divider-long">
        <div id="sampleButton" wix-ctrl="Button"
            wix-options="{label: 'Apply', className: 'btn-confirm-primary', icon: 'image-change'}">
        </div>
    </body>
</html>
