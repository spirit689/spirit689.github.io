<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script type="text/javascript" src="//static.parastorage.com/services/js-sdk/1.87.0/js/wix.min.js"></script>
    <script src="//static.parastorage.com/services/third-party/jquery/3.1.1/dist/jquery.min.js"></script>
    <script src="//static.parastorage.com/services/third-party/lodash/4.17.2/lodash.js"></script>
    <style>
        * { margin: 0; padding: 0; }
        body { width: 100%; height: 100%; background: red; }
        body.editor {
            background: #FFFFFF;
        }
        .button {
            background-color: #ccc;
            padding: 10px;
            margin: 5px;
            display: inline-block;
        }
    </style>
    <script type="text/javascript">
        //-----------------
        var Widget = function() {
            this.cfg = {
                isReady: false,
                delay: 500,
                classExpand: '.expand',
                classRestore: '.restore',
                classHide: '.hide',
            }
        }

        Widget.prototype.isReady = function () {
            return cfg.isReady;
        }

        Widget.prototype.initWidget = function() {
            var $self = this;
            $self.cfg.isReady = false;
            Wix.getBoundingRectAndOffsets(function(data) {
                $self.cfg.height = data.offsets.y + data.rect.height;
                $self.cfg.width = data.offsets.x + data.rect.width;
                $self.cfg.isReady = true;
                console.log('rect data', data);
            });

            // Wix.Styles.getStyleParams(function(data) {
            //     console.log('style ', data);
            // });
        }

        Widget.prototype.setSize = function(w, h) {
            Wix.resizeWindow(w, h);
        }

        Widget.prototype.expandSize = function() {
            console.log('screen', window.screen);
            console.log('cfg', this.cfg);
            Wix.resizeWindow(window.screen.width, window.screen.height);
        }

        Widget.prototype.restoreSize = function() {
            Wix.resizeWindow(this.cfg.width, this.cfg.height);
        }

        Widget.prototype.changeContent = function () {
            var mode = Wix.Utils.getViewMode();
            jQuery('body').attr('class', Wix.Utils.getViewMode());
            // console.log('mode ', mode);
            if(mode == 'editor' || mode == 'preview') {
                jQuery('.placeholder').show();
                jQuery('.content').html('');
            } else {
                jQuery('.placeholder').hide();
                Wix.Data.Public.get('textCode', { scope: 'COMPONENT' },
                function(data) {
                    // console.log('data get ', data);
                    if(data['textCode']) {
                        jQuery('.content').html(data['textCode']);
                    }
                }, function(f) {
                    console.log('data get error', f);
                    jQuery('.content').html('Something wrong see log :(');
                });
            }
        }
        //-----------------
        var widget = new Widget();

        Wix.addEventListener(Wix.Events.SETTINGS_UPDATED, function (data) {
            console.log('settings ', data);
            if(data.key == 'textCode') {
                Wix.Data.Public.set('textCode', data.value, { scope: 'COMPONENT' },
                function(d){console.log('data set ', d)}, function(f){ console.log('data set error ', f)});
            }
        });

        // Wix.addEventListener(Wix.Events.STYLE_PARAMS_CHANGE, function (data) {
        //     console.log('style ', data);
        // });

        Wix.addEventListener(Wix.Events.EDIT_MODE_CHANGE, function () {
            widget.changeContent();
        });
        Wix.addEventListener(Wix.Events.PAGE_NAVIGATION, function () {
            location.reload();
        });

        jQuery(document).ready(function() {
            widget.initWidget();
            widget.changeContent();
        });

        jQuery(document).on('click', widget.cfg.classExpand, function(ev) {
            ev.preventDefault();
            widget.expandSize();
        });

        jQuery(document).on('click', widget.cfg.classRestore, function(ev) {
            ev.preventDefault();
            setTimeout(function () {
                widget.restoreSize();
            }, widget.cfg.delay);
        });
    </script>
</head>
<body>
    <div class="placeholder">[Widget]</div>
    <div class="content"></div>
</body>
</html>
